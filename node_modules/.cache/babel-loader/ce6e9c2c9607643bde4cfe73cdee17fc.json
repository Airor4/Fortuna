{"ast":null,"code":"import BoundingBox from './BoundingBox.js';\nimport CasusBlock from './CasusBlock.js';\nimport EmptyBlock from './EmptyBlock.js';\nimport Vec from './Vec.js';\nimport generateCornerPerim from './generateCornerPerim.js';\nimport measureText from './measureText.js';\nimport { CENTER_WIDTH, RAMP_WIDTH, VPADDING } from './generateCornerPerim.js';\n\nclass BinaryOperationBlock extends CasusBlock {\n  constructor(paramType, returnType, centerText, leftText = \"\") {\n    super();\n    this.lChild = new EmptyBlock(paramType);\n    this.rChild = new EmptyBlock(paramType);\n    this.paramType = paramType;\n    this.returnType = returnType;\n    this.centerText = centerText;\n    this.centerTextWidth = measureText(centerText).w + CENTER_WIDTH;\n    this.leftText = leftText;\n\n    if (this.leftText.length === 0) {\n      this.leftTextWidth = 0;\n    } else {\n      this.leftTextWidth = measureText(leftText).w + CENTER_WIDTH;\n    }\n  }\n\n  precompBounds() {\n    this.lChild.precompBounds();\n    this.rChild.precompBounds();\n    this.boundingBox = new BoundingBox(0, 0, RAMP_WIDTH + this.leftTextWidth + this.lChild.boundingBox.w + this.centerTextWidth + this.rChild.boundingBox.w + RAMP_WIDTH, VPADDING + Math.max(this.lChild.boundingBox.h, this.rChild.boundingBox.h) + VPADDING);\n  }\n\n  precompXY(x, y) {\n    this.boundingBox.x = x;\n    this.boundingBox.y = y;\n    const lChildX = x + RAMP_WIDTH + this.leftTextWidth;\n    const rChildX = lChildX + this.lChild.boundingBox.w + this.centerTextWidth;\n    const lChildYSpace = this.boundingBox.h - this.lChild.boundingBox.h;\n    const rChildYSpace = this.boundingBox.h - this.rChild.boundingBox.h;\n    const lChildY = y + lChildYSpace / 2;\n    const rChildY = y + rChildYSpace / 2;\n    this.lChild.precompXY(lChildX, lChildY);\n    this.rChild.precompXY(rChildX, rChildY);\n  }\n\n  getChildBlocks() {\n    return [this.lChild, this.rChild];\n  }\n\n  removeBlockAt(v, removeAfter) {\n    if (!this.boundingBox.contains(v)) {\n      return [];\n    }\n\n    const lChildRes = this.lChild.removeBlockAt(v, removeAfter);\n\n    if (lChildRes.length > 0) {\n      return lChildRes;\n    }\n\n    if (this.lChild.boundingBox.contains(v) && this.lChild.draggable()) {\n      const toReturn = [this.lChild];\n      this.lChild = new EmptyBlock(this.paramType);\n      return toReturn;\n    }\n\n    const rChildRes = this.rChild.removeBlockAt(v, removeAfter);\n\n    if (rChildRes.length > 0) {\n      return rChildRes;\n    }\n\n    if (this.rChild.boundingBox.contains(v) && this.rChild.draggable()) {\n      const toReturn = [this.rChild];\n      this.rChild = new EmptyBlock(this.paramType);\n      return toReturn;\n    }\n\n    return [];\n  }\n\n  getPerim() {\n    return generateCornerPerim(this.boundingBox, this.returnType);\n  }\n\n  drawSelf(ctx) {\n    ctx.fillStyle = '#eeee22';\n    const perim = this.getPerim();\n    ctx.beginPath();\n    ctx.moveTo(perim[0].x, perim[0].y);\n\n    for (const p of perim) {\n      ctx.lineTo(p.x, p.y);\n    }\n\n    ctx.fill();\n    ctx.fillStyle = '#000000';\n    ctx.font = '16px Arial';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillText(this.leftText, this.boundingBox.x + RAMP_WIDTH + this.leftTextWidth / 2, this.boundingBox.y + this.boundingBox.h / 2);\n    ctx.fillText(this.centerText, this.boundingBox.x + RAMP_WIDTH + this.leftTextWidth + this.lChild.boundingBox.w + this.centerTextWidth / 2, this.boundingBox.y + this.boundingBox.h / 2);\n  }\n\n  getReturnType() {\n    return this.returnType;\n  }\n\n  tryToPlace(v, blockToPlace, ctx) {\n    var _this$lChild$tryToPla, _this$rChild$tryToPla;\n\n    if (!this.boundingBox.contains(v)) {\n      return null;\n    }\n\n    this.lChild = (_this$lChild$tryToPla = this.lChild.tryToPlace(v, blockToPlace, ctx)) !== null && _this$lChild$tryToPla !== void 0 ? _this$lChild$tryToPla : this.lChild;\n    this.rChild = (_this$rChild$tryToPla = this.rChild.tryToPlace(v, blockToPlace, ctx)) !== null && _this$rChild$tryToPla !== void 0 ? _this$rChild$tryToPla : this.rChild;\n    return null;\n  }\n\n}\n\nexport default BinaryOperationBlock;","map":{"version":3,"sources":["/Users/Airor/Desktop/Fortuna/Fortuna/fortuna/src/casus/blocks/BinaryOperationBlock.js"],"names":["BoundingBox","CasusBlock","EmptyBlock","Vec","generateCornerPerim","measureText","CENTER_WIDTH","RAMP_WIDTH","VPADDING","BinaryOperationBlock","constructor","paramType","returnType","centerText","leftText","lChild","rChild","centerTextWidth","w","length","leftTextWidth","precompBounds","boundingBox","Math","max","h","precompXY","x","y","lChildX","rChildX","lChildYSpace","rChildYSpace","lChildY","rChildY","getChildBlocks","removeBlockAt","v","removeAfter","contains","lChildRes","draggable","toReturn","rChildRes","getPerim","drawSelf","ctx","fillStyle","perim","beginPath","moveTo","p","lineTo","fill","font","textAlign","textBaseline","fillText","getReturnType","tryToPlace","blockToPlace"],"mappings":"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","sourcesContent":["//@flow strict\n\nimport BoundingBox from './BoundingBox.js';\nimport CasusBlock from './CasusBlock.js';\nimport EmptyBlock from './EmptyBlock.js';\nimport Vec from './Vec.js'\nimport generateCornerPerim from './generateCornerPerim.js'\nimport measureText from './measureText.js'\n\nimport {\n\tCENTER_WIDTH, \n\tRAMP_WIDTH, \n\tVPADDING, \n} from './generateCornerPerim.js';\n\nimport type {DataType} from './DataType.js'\n\nclass BinaryOperationBlock extends CasusBlock {\n\n\tlChild: CasusBlock;\n\trChild: CasusBlock;\n\tparamType: DataType;\n\treturnType: DataType;\n\tcenterText: string;\n\tcenterTextWidth: number;\n\tleftText: string;\n\tleftTextWidth: number;\n\n\tconstructor(paramType: DataType, returnType: DataType, centerText: string, leftText: string = \"\") {\n\t\tsuper();\n\n\t\tthis.lChild=new EmptyBlock(paramType);\n\t\tthis.rChild=new EmptyBlock(paramType);\n\t\tthis.paramType=paramType;\n\t\tthis.returnType=returnType;\n\t\tthis.centerText=centerText;\n\t\tthis.centerTextWidth=measureText(centerText).w + CENTER_WIDTH;\n\t\tthis.leftText=leftText;\n\t\tif (this.leftText.length === 0) {\n\t\t\tthis.leftTextWidth = 0;\n\t\t}\n\t\telse {\n\t\t\tthis.leftTextWidth = measureText(leftText).w + CENTER_WIDTH;\n\t\t}\n\t}\n\n\tprecompBounds(): void {\n\t\tthis.lChild.precompBounds();\n\t\tthis.rChild.precompBounds();\n\n\t\tthis.boundingBox=new BoundingBox(\n\t\t\t0, \n\t\t\t0, \n\t\t\tRAMP_WIDTH + this.leftTextWidth + \n\t\t\t\tthis.lChild.boundingBox.w + this.centerTextWidth + this.rChild.boundingBox.w + RAMP_WIDTH, \n\t\t\tVPADDING+Math.max(this.lChild.boundingBox.h, this.rChild.boundingBox.h)+VPADDING\n\t\t);\t\n\t}\n\n\tprecompXY(x: number, y:number): void {\n\t\tthis.boundingBox.x=x;\n\t\tthis.boundingBox.y=y;\n\t\tconst lChildX = x + RAMP_WIDTH + this.leftTextWidth;\n\t\tconst rChildX = lChildX + this.lChild.boundingBox.w + this.centerTextWidth;\n\n\t\tconst lChildYSpace=this.boundingBox.h-this.lChild.boundingBox.h;\n\t\tconst rChildYSpace=this.boundingBox.h-this.rChild.boundingBox.h;\n\t\tconst lChildY=y+lChildYSpace/2;\n\t\tconst rChildY=y+rChildYSpace/2;\n\n\t\tthis.lChild.precompXY(lChildX, lChildY);\n\t\tthis.rChild.precompXY(rChildX, rChildY);\n\t}\n\n\tgetChildBlocks(): Array<CasusBlock> {\n\t\treturn [this.lChild, this.rChild];\n\t}\n\n\tremoveBlockAt(v: Vec, removeAfter: boolean): Array<CasusBlock> {\n\t\tif (!this.boundingBox.contains(v)) {\n\t\t\treturn [];\n\t\t}\n\t\tconst lChildRes = this.lChild.removeBlockAt(v, removeAfter);\n\t\tif (lChildRes.length > 0) {\n\t\t\treturn lChildRes;\n\t\t}\n\t\tif (this.lChild.boundingBox.contains(v) && this.lChild.draggable()) {\n\t\t\tconst toReturn=[this.lChild];\n\t\t\tthis.lChild=new EmptyBlock(this.paramType);\n\t\t\treturn toReturn;\n\t\t}\n\n\t\tconst rChildRes = this.rChild.removeBlockAt(v, removeAfter);\n\t\tif (rChildRes.length > 0) {\n\t\t\treturn rChildRes;\n\t\t}\n\t\tif (this.rChild.boundingBox.contains(v) && this.rChild.draggable()) {\n\t\t\tconst toReturn=[this.rChild];\n\t\t\tthis.rChild=new EmptyBlock(this.paramType);\n\t\t\treturn toReturn;\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tgetPerim(): Array<Vec> {\n\t\treturn generateCornerPerim(this.boundingBox, this.returnType);\n\t}\n\n\tdrawSelf(ctx: CanvasRenderingContext2D): void {\n\t\tctx.fillStyle = '#eeee22';\n\n\t\tconst perim: Array<Vec> = this.getPerim();\n\t\tctx.beginPath();\n\t\tctx.moveTo(perim[0].x, perim[0].y);\n\t\tfor (const p of perim) {\n\t\t\tctx.lineTo(p.x, p.y);\n\t\t}\n\t\tctx.fill();\n\n\t\tctx.fillStyle = '#000000';\n\t\tctx.font = '16px Arial';\n\t\tctx.textAlign = 'center';\n\t\tctx.textBaseline = 'middle';\n\n\t\tctx.fillText(\n\t\t\tthis.leftText, \n\t\t\tthis.boundingBox.x + RAMP_WIDTH + this.leftTextWidth/2,\n\t\t\tthis.boundingBox.y + this.boundingBox.h/2\n\t\t);\n\t\tctx.fillText(\n\t\t\tthis.centerText, \n\t\t\tthis.boundingBox.x + RAMP_WIDTH + this.leftTextWidth + this.lChild.boundingBox.w + this.centerTextWidth/2, \n\t\t\tthis.boundingBox.y + this.boundingBox.h/2\n\t\t);\n\t}\n\n\tgetReturnType(): DataType {\n\t\treturn this.returnType;\n\t}\n\n\ttryToPlace(v: Vec, blockToPlace: CasusBlock, ctx: ?CanvasRenderingContext2D): ?CasusBlock {\n\t\tif (!this.boundingBox.contains(v)) {\n\t\t\treturn null;\n\t\t}\n\t\tthis.lChild = this.lChild.tryToPlace(v, blockToPlace, ctx) ?? this.lChild;\n\t\tthis.rChild = this.rChild.tryToPlace(v, blockToPlace, ctx) ?? this.rChild;\n\t\treturn null;\n\t}\n\n}\n\nexport default BinaryOperationBlock;\n"]},"metadata":{},"sourceType":"module"}